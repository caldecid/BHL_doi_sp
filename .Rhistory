plants_bra[which(stringr::str_detect(plants_bra$taxon_name,
"-")), ]
##removing hifen
plants_hifen$taxon_name =  stringr::str_replace(plants_hifen$taxon_name,
"-", "")
## joining datasets
plants_bra <- rbind(plants_bra, plants_hifen)
##family names
fam_names <- unique(plants_bra$Family)
######creating list for keeping the missing species within each family according to IPNI
list_fam_IPNI <- vector("list", length = length(fam_names))
##naming
names(list_fam_IPNI) <- fam_names
###################IPNI######################################
##loop for finding missing species in the Flora de Brasil
for(i in seq_along(fam_names)){
###tryCatch for handling the missing families in IPNI
tryCatch({
##calling the species within families in IPNI
ipni_df = tidy(kewr::search_ipni(list(family = fam_names[i],
distribution = "Brazil"),
limit = 1000,
filters = c("species")))
}, error = function(e){
message("Absent family in IPNI")
print(e)
})
##IPNI species present in Flora de Brasil
ipni_present = ipni_df[which(ipni_df$name %in% plants_bra$taxon_name), ]
##if else statement for not saving empty dfs
if(dim(ipni_present)[1] == 0){
print("No species present in IPNI")
list_fam_IPNI[[i]] = NULL
} else{
##inserting a df inside each list with the missing species in the Flora Brazil
list_fam_IPNI[[i]] = ipni_present
}
}
###removing null elements
list_fam_IPNI = list_fam_IPNI[-which(sapply(list_fam_IPNI, is.null))]
#####collapsing the list in a df
df_ipni_families <- do.call("rbind.fill", list_fam_IPNI) %>%
dplyr::select(tidyselect::any_of(c("name", "family", "genus",
"species",
"hybrid",
"rank", "reference",
"publication", "publicationYear",
"distribution","id", "bhlLink",
"remarks")))%>%
dplyr::mutate(url = paste0("www.ipni.org/n/", id))
##working with the columns
df_ipni_families$citationType <- "tax_nov"
df_ipni_families$source <- "IPNI"
##obtaining the doi
df_ipni_families$doi <- ifelse(str_detect(df_ipni_families$remarks,
"doi:[^\\s]+"),
paste0("https://doi.org/",
str_extract(df_ipni_families$remarks,
"(?<=doi:)[^\\s]+")), NA)
rownames(df_ipni_families) <- NULL
##eliminating duplicated species
df_ipni_families <- df_ipni_families[-which(duplicated(df_ipni_families$name)),]
##removing hybrid species
df_ipni_families <- df_ipni_families %>% dplyr::filter(hybrid == "FALSE")
##removing hybrid column
df_ipni_families <- df_ipni_families %>% dplyr::select(-hybrid)
return(df_ipni_families)
}
##running function of missing species in Flora de Brasil
df_BHL <- BHL_function(df = angio)
View(df_BHL)
##replacing Leguminosae by Fabaceae
df_BHL <- df_BHL %>% mutate(family = case_when(family == "Leguminosae" ~ "Fabaceae",
.default = as.character(family)))
##family present
family_x <- sort(unique(df_BHL$family))
##family present
family_x <- sort(unique(df_BHL$family))
##list for each family
list_present <- vector("list", length = length(family_x))
##recovering ID
angio_id <- angio %>% select(ID, Family) %>% drop_na %>%
filter(Family %in% family_x)
##list for each family
list_present <- vector("list", length = length(family_x))
##recovering ID
angio_id <- angio %>% select(ID, Family) %>% drop_na %>%
filter(Family %in% family_x)
##for loop for generating the list and the csv file for each family
for(i in seq_along(family_x)){
list_present[[i]] <- df_BHL %>% filter(family == family_x[i])
write_csv(list_present[[i]],
file =paste0("Data/Processed/Angiosperms/",
family_x[i], "_FB",
angio_id$ID[i], ".csv"))
}
##for loop for generating the list and the csv file for each family
for(i in seq_along(family_x)){
list_present[[i]] <- df_BHL %>% filter(family == family_x[i])
write_csv(list_present[[i]],
file =paste0("Data/Processed/Angiosperms/Family",
family_x[i], "_FB",
angio_id$ID[i], ".csv"))
}
##for loop for generating the list and the csv file for each family
for(i in seq_along(family_x)){
list_present[[i]] <- df_BHL %>% filter(family == family_x[i])
write_csv(list_present[[i]],
file =paste0("Data/Processed/Angiosperms/Family/",
family_x[i], "_FB",
angio_id$ID[i], ".csv"))
}
gymnosperms <- read_excel("Data/Raw/datasheet_gymnosperms_en.xlsx")
gymnosperms <- read_excel("Data/Raw/datasheet_gymnosperms_en.xlsx")
x_gymno <- BHL_function(df = gymnosperms)
##family present
family_gymno <- sort(unique(x_gymno$family))
##list for each family
list_gymno <- vector("list", length = length(family_gymno))
##recovering ID
gymno_id <- gymnosperms %>% select(ID, Family) %>% drop_na %>%
filter(Family %in% family_gymno)
##for loop for generating the list and the csv file for each family
for(i in seq_along(family_gymno)){
list_gymno[[i]] <- x_gymno %>% filter(family == family_gymno[i])
write_csv(list_gymno[[i]],
file =paste0("Data/Processed/Gymnosperms/Family/",
family_gymno[i], "_FB",
gymno_id$ID[i], ".csv"))
}
# Ferns -------------------------------------------------------------------
ferns <- read_excel("Data/Raw/datasheet_ferns_en.xlsx")
x_ferns <- BHL_function(df = ferns)
##family present
family_ferns <- sort(unique(x_ferns$family))
##list for each family
list_ferns <- vector("list", length = length(family_ferns))
##recovering ID
ferns_id <- ferns %>% select(ID, Family) %>% drop_na %>%
filter(Family %in% family_ferns)
##for loop for generating the list and the csv file for each family
for(i in seq_along(family_ferns)){
list_ferns[[i]] <- x_ferns %>% filter(family == family_ferns[i])
write_csv(list_ferns[[i]],
file =paste0("Data/Processed/Ferns/Family/",
family_ferns[i], "_FB",
ferns_id$ID[i], ".csv"))
}
View(gymnosperms)
x_gymno <- BHL_function(df = gymnosperms)
View(x_gymno)
View(x_ferns)
gymno_id
df = gymnosperms
plants_bra = complete_df(df = df)
View(plants_bra)
##dataset with only species with hifen
plants_hifen =
plants_bra[which(stringr::str_detect(plants_bra$taxon_name,
"-")), ]
##removing hifen
plants_hifen$taxon_name =  stringr::str_replace(plants_hifen$taxon_name,
"-", "")
## joining datasets
plants_bra <- rbind(plants_bra, plants_hifen)
##family names
fam_names <- unique(plants_bra$Family)
######creating list for keeping the missing species within each family according to IPNI
list_fam_IPNI <- vector("list", length = length(fam_names))
##naming
names(list_fam_IPNI) <- fam_names
fam_names[1]
##calling the species within families in IPNI
ipni_df = tidy(kewr::search_ipni(list(family = fam_names[1],
distribution = "Brazil"),
limit = 1000,
filters = c("species")))
##calling the species within families in IPNI
ipni_df = tidy(kewr::search_ipni(list(family = fam_names[56],
distribution = "Brazil"),
limit = 1000,
filters = c("species")))
fam_names
##calling the species within families in IPNI
ipni_df = tidy(kewr::search_ipni(list(family = fam_names[8],
distribution = "Brazil"),
limit = 1000,
filters = c("species")))
View(ipni_df)
##IPNI species present in Flora de Brasil
ipni_present = ipni_df[which(ipni_df$name %in% plants_bra$taxon_name), ]
View(ipni_present)
##if else statement for not saving empty dfs
if(dim(ipni_present)[1] == 0){
print("No species present in IPNI")
list_fam_IPNI[[8]] = NULL
} else{
##inserting a df inside each list with the missing species in the Flora Brazil
list_fam_IPNI[[8]] = ipni_present
}
View(list_fam_IPNI)
###removing null elements
list_fam_IPNI = list_fam_IPNI[-which(sapply(list_fam_IPNI, is.null))]
View(list_fam_IPNI)
#####collapsing the list in a df
df_ipni_families <- do.call("rbind.fill", list_fam_IPNI) %>%
dplyr::select(tidyselect::any_of(c("name", "family", "genus",
"species",
"hybrid",
"rank", "reference",
"publication", "publicationYear",
"distribution","id", "bhlLink",
"remarks")))%>%
dplyr::mutate(url = paste0("www.ipni.org/n/", id))
View(df_ipni_families)
##working with the columns
df_ipni_families$citationType <- "tax_nov"
df_ipni_families$source <- "IPNI"
##obtaining the doi
df_ipni_families$doi <- ifelse(str_detect(df_ipni_families$remarks,
"doi:[^\\s]+"),
paste0("https://doi.org/",
str_extract(df_ipni_families$remarks,
"(?<=doi:)[^\\s]+")), NA)
#####collapsing the list in a df
df_ipni_families <- do.call("rbind.fill", list_fam_IPNI) %>%
dplyr::select(tidyselect::any_of(c("name", "family", "genus",
"species",
"hybrid",
"rank", "reference",
"publication", "publicationYear",
"distribution","id", "bhlLink",
"remarks")))%>%
dplyr::mutate(url = paste0("www.ipni.org/n/", id))
##working with the columns
df_ipni_families$citationType <- "tax_nov"
df_ipni_families$source <- "IPNI"
View(df_ipni_families)
View(ipni_present)
#####collapsing the list in a df
df_ipni_families <- do.call("rbind.fill", list_fam_IPNI) %>%
dplyr::select(tidyselect::any_of(c("name", "family", "genus",
"species",
"hybrid",
"rank", "reference",
"publication", "publicationYear",
"distribution","id", "bhlLink",
"remarks")))%>%
dplyr::mutate(url = paste0("www.ipni.org/n/", id))
##working with the columns
df_ipni_families$citationType <- "tax_nov"
df_ipni_families$source <- "IPNI"
##obtaining the doi
df_ipni_families$doi <- ifelse(str_detect(df_ipni_families$remarks,
"doi:[^\\s]+"),
paste0("https://doi.org/",
str_extract(df_ipni_families$remarks,
"(?<=doi:)[^\\s]+")), NA)
View(df_ipni_families)
rownames(df_ipni_families) <- NULL
##eliminating duplicated species
df_ipni_families <- df_ipni_families[-which(duplicated(df_ipni_families$name)),]
#####collapsing the list in a df
df_ipni_families <- do.call("rbind.fill", list_fam_IPNI) %>%
dplyr::select(tidyselect::any_of(c("name", "family", "genus",
"species",
"hybrid",
"rank", "reference",
"publication", "publicationYear",
"distribution","id", "bhlLink",
"remarks")))%>%
dplyr::mutate(url = paste0("www.ipni.org/n/", id))
##working with the columns
df_ipni_families$citationType <- "tax_nov"
df_ipni_families$source <- "IPNI"
##obtaining the doi
df_ipni_families$doi <- ifelse(str_detect(df_ipni_families$remarks,
"doi:[^\\s]+"),
paste0("https://doi.org/",
str_extract(df_ipni_families$remarks,
"(?<=doi:)[^\\s]+")), NA)
rownames(df_ipni_families) <- NULL
##eliminating duplicated species
df_ipni_families <- df_ipni_families[-which(duplicated(df_ipni_families$name)),]
#####collapsing the list in a df
df_ipni_families <- do.call("rbind.fill", list_fam_IPNI) %>%
dplyr::select(tidyselect::any_of(c("name", "family", "genus",
"species",
"hybrid",
"rank", "reference",
"publication", "publicationYear",
"distribution","id", "bhlLink",
"remarks")))%>%
dplyr::mutate(url = paste0("www.ipni.org/n/", id))
##working with the columns
df_ipni_families$citationType <- "tax_nov"
df_ipni_families$source <- "IPNI"
##obtaining the doi
df_ipni_families$doi <- ifelse(str_detect(df_ipni_families$remarks,
"doi:[^\\s]+"),
paste0("https://doi.org/",
str_extract(df_ipni_families$remarks,
"(?<=doi:)[^\\s]+")), NA)
rownames(df_ipni_families) <- NULL
df_ipni_families$name
duplicated(df_ipni_families$name)
which(duplicated(df_ipni_families$name))
df_ipni_familie[-0, ]
df_ipni_families[-0, ]
#####collapsing the list in a df
df_ipni_families <- do.call("rbind.fill", list_fam_IPNI) %>%
dplyr::select(tidyselect::any_of(c("name", "family", "genus",
"species",
"hybrid",
"rank", "reference",
"publication", "publicationYear",
"distribution","id", "bhlLink",
"remarks")))%>%
dplyr::mutate(url = paste0("www.ipni.org/n/", id))
##working with the columns
df_ipni_families$citationType <- "tax_nov"
df_ipni_families$source <- "IPNI"
##obtaining the doi
df_ipni_families$doi <- ifelse(str_detect(df_ipni_families$remarks,
"doi:[^\\s]+"),
paste0("https://doi.org/",
str_extract(df_ipni_families$remarks,
"(?<=doi:)[^\\s]+")), NA)
rownames(df_ipni_families) <- NULL
##eliminating duplicated species
if(duplicated(df_ipni_families$name) == 0){
df_ipni_families
} else {
df_ipni_families <- df_ipni_families[-which(duplicated(df_ipni_families$name)),]
}
duplicated(df_ipni_families$name)
##eliminating duplicated species
if(sum(duplicated(df_ipni_families$name)) == 0){
df_ipni_families
} else {
df_ipni_families <- df_ipni_families[-which(duplicated(df_ipni_families$name)),]
}
##removing hybrid species
df_ipni_families <- df_ipni_families %>% dplyr::filter(hybrid == "FALSE")
##removing hybrid column
df_ipni_families <- df_ipni_families %>% dplyr::select(-hybrid)
#####collapsing the list in a df
df_ipni_families <- do.call("rbind.fill", list_fam_IPNI) %>%
dplyr::select(tidyselect::any_of(c("name", "family", "genus",
"species",
"hybrid",
"rank", "reference",
"publication", "publicationYear",
"distribution","id", "bhlLink",
"remarks")))%>%
dplyr::mutate(url = paste0("www.ipni.org/n/", id))
##working with the columns
df_ipni_families$citationType <- "tax_nov"
df_ipni_families$source <- "IPNI"
##obtaining the doi
df_ipni_families$doi <- ifelse(str_detect(df_ipni_families$remarks,
"doi:[^\\s]+"),
paste0("https://doi.org/",
str_extract(df_ipni_families$remarks,
"(?<=doi:)[^\\s]+")), NA)
rownames(df_ipni_families) <- NULL
##eliminating duplicated species
if(sum(duplicated(df_ipni_families$name)) == 0){
df_ipni_families
} else {
df_ipni_families <- df_ipni_families[-which(duplicated(df_ipni_families$name)),]
}
##removing hybrid species
df_ipni_families <- df_ipni_families %>% dplyr::filter(hybrid == "FALSE")
##removing hybrid column
df_ipni_families <- df_ipni_families %>% dplyr::select(-hybrid)
df_ipni_families
BHL_function <- function(df){
##completing dataframe information (auxiliary function)
plants_bra = complete_df(df = df)
##dataset with only species with hifen
plants_hifen =
plants_bra[which(stringr::str_detect(plants_bra$taxon_name,
"-")), ]
##removing hifen
plants_hifen$taxon_name =  stringr::str_replace(plants_hifen$taxon_name,
"-", "")
## joining datasets
plants_bra <- rbind(plants_bra, plants_hifen)
##family names
fam_names <- unique(plants_bra$Family)
######creating list for keeping the missing species within each family according to IPNI
list_fam_IPNI <- vector("list", length = length(fam_names))
##naming
names(list_fam_IPNI) <- fam_names
###################IPNI######################################
##loop for finding missing species in the Flora de Brasil
for(i in seq_along(fam_names)){
###tryCatch for handling the missing families in IPNI
tryCatch({
##calling the species within families in IPNI
ipni_df = tidy(kewr::search_ipni(list(family = fam_names[i],
distribution = "Brazil"),
limit = 1000,
filters = c("species")))
}, error = function(e){
message("Absent family in IPNI")
print(e)
})
##IPNI species present in Flora de Brasil
ipni_present = ipni_df[which(ipni_df$name %in% plants_bra$taxon_name), ]
##if else statement for not saving empty dfs
if(dim(ipni_present)[1] == 0){
print("No species present in IPNI")
list_fam_IPNI[[i]] = NULL
} else{
##inserting a df inside each list with the missing species in the Flora Brazil
list_fam_IPNI[[i]] = ipni_present
}
}
###removing null elements
list_fam_IPNI = list_fam_IPNI[-which(sapply(list_fam_IPNI, is.null))]
#####collapsing the list in a df
df_ipni_families <- do.call("rbind.fill", list_fam_IPNI) %>%
dplyr::select(tidyselect::any_of(c("name", "family", "genus",
"species",
"hybrid",
"rank", "reference",
"publication", "publicationYear",
"distribution","id", "bhlLink",
"remarks")))%>%
dplyr::mutate(url = paste0("www.ipni.org/n/", id))
##working with the columns
df_ipni_families$citationType <- "tax_nov"
df_ipni_families$source <- "IPNI"
##obtaining the doi
df_ipni_families$doi <- ifelse(str_detect(df_ipni_families$remarks,
"doi:[^\\s]+"),
paste0("https://doi.org/",
str_extract(df_ipni_families$remarks,
"(?<=doi:)[^\\s]+")), NA)
rownames(df_ipni_families) <- NULL
##eliminating duplicated species
if(sum(duplicated(df_ipni_families$name)) == 0){
df_ipni_families
} else {
df_ipni_families <- df_ipni_families[-which(duplicated(df_ipni_families$name)),]
}
##removing hybrid species
df_ipni_families <- df_ipni_families %>% dplyr::filter(hybrid == "FALSE")
##removing hybrid column
df_ipni_families <- df_ipni_families %>% dplyr::select(-hybrid)
return(df_ipni_families)
}
##calling dataset
angio <- read_excel("Data/Raw/datasheet_angiosperms_en.xlsx")
##running function of missing species in Flora de Brasil
df_BHL <- BHL_function(df = angio)
##replacing Leguminosae by Fabaceae
df_BHL <- df_BHL %>% mutate(family = case_when(family == "Leguminosae" ~ "Fabaceae",
.default = as.character(family)))
##family present
family_x <- sort(unique(df_BHL$family))
##list for each family
list_present <- vector("list", length = length(family_x))
##recovering ID
angio_id <- angio %>% select(ID, Family) %>% drop_na %>%
filter(Family %in% family_x)
##for loop for generating the list and the csv file for each family
for(i in seq_along(family_x)){
list_present[[i]] <- df_BHL %>% filter(family == family_x[i])
write_csv(list_present[[i]],
file =paste0("Data/Processed/Angiosperms/Family/",
family_x[i], "_FB",
angio_id$ID[i], ".csv"))
}
# Gymnosperms ---------------------------------------------------------------
gymnosperms <- read_excel("Data/Raw/datasheet_gymnosperms_en.xlsx")
x_gymno <- BHL_function(df = gymnosperms)
##family present
family_gymno <- sort(unique(x_gymno$family))
##list for each family
list_gymno <- vector("list", length = length(family_gymno))
##recovering ID
gymno_id <- gymnosperms %>% select(ID, Family) %>% drop_na %>%
filter(Family %in% family_gymno)
##for loop for generating the list and the csv file for each family
for(i in seq_along(family_gymno)){
list_gymno[[i]] <- x_gymno %>% filter(family == family_gymno[i])
write_csv(list_gymno[[i]],
file =paste0("Data/Processed/Gymnosperms/Family/",
family_gymno[i], "_FB",
gymno_id$ID[i], ".csv"))
}
# Ferns -------------------------------------------------------------------
ferns <- read_excel("Data/Raw/datasheet_ferns_en.xlsx")
x_ferns <- BHL_function(df = ferns)
##family present
family_ferns <- sort(unique(x_ferns$family))
##list for each family
list_ferns <- vector("list", length = length(family_ferns))
##recovering ID
ferns_id <- ferns %>% select(ID, Family) %>% drop_na %>%
filter(Family %in% family_ferns)
##for loop for generating the list and the csv file for each family
for(i in seq_along(family_ferns)){
list_ferns[[i]] <- x_ferns %>% filter(family == family_ferns[i])
write_csv(list_ferns[[i]],
file =paste0("Data/Processed/Ferns/Family/",
family_ferns[i], "_FB",
ferns_id$ID[i], ".csv"))
}
